\documentclass{report}
\usepackage{cite}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{amsmath}
\begin{document}

 \include{thesisfront}  
 
  \section*{Abstract}
% Do not forget to check each reference while importing in your Bibtex file.
% Especially, IEEExplore export may lead to ill-formatted conference name like \emph{Robotics and Automation, 
% IEEE International Conference on}.
\par An Internet company - Baidu is working on the autonomous driving, they have introduced a local path planning algorithm - expectation maximum planner(EM planner), this is a sampling-based algorithm. We hope to apply this algorithm to logistics robots to achieve the purpose of automatic delivery.\\
\indent
Compared with logistics robots, autonomous vehicles have higher requirements for various algorithms. Autonomous vehicles need to face more complex road environments, and they must be able to respond quickly when driving at high speeds.
We can apply the algorithm to the logistics robots, but considering the cost of logistics robots, their motherboards have lower computing capability, if we use the exhaustive search approach (brute-forced search), the EM planner can always make an ideal choice based on the cost function. However, due to the limited computing capability of the motherboard, we need to adopt appropriate strategies to make the right behavior quickly and well.\\
\indent
The objective of this bibliography report is to present the state-of-the-art work on EM planner, with focus on details of algorithm implementation.


 \newpage
 
 \section*{Acknowledgements}
 First of all, I would like to thank Prof. Olivier Kermorgant agreed to my request to return to China for internship. \\
 \indent
 I am thankful to the Meituan can give me a great opportunity to work on a topic of my interest.
 
 \newpage
 
 \section*{Notations}
 \begin{tabular}{ll}
 $\Omega$ & The 3D space-time\\
 $\mathcal V$ & Vehicle\\
 S & Statement
 \end{tabular}
  \newpage
  \section*{Abbreviations}
  \begin{tabular}{ll}
  EM planner  & Expectation Maximum Planner\\
  MP framework & Motion Planning Framework\\
  DP & Dynamic Programming\\
  E-step & SL and ST Mapping\\
  M-step & Dynamic Programming of Speed and Path
  
  \end{tabular}
  
 
 \newpage
 
 \listoffigures
 
%\listoftables
 
 \tableofcontents
 
 
 \chapter*{Introduction}
 \addcontentsline{toc}{chapter}{Introduction}	 
 Autonomous driving research began in the 1980s and has significantly grown over the past ten years. Autonomous driving aims to reduce road fatalities, increase traffic efficiency and provide convenient travel. However, autonomous driving is a challenging task that requires accurately sensing the environment, a deep understanding of vehicle intentions and safe driving under different scenarios.\\
 \indent
 The HD map module provides a
 high-definition map that can be accessed by every online module. Perception and localization modules provide the necessary dynamic environment information, which can be further used to predict future environment status in the prediction module. The motion planning module considers all information to generate a safe and smooth trajectory to feed into the vehicle control module.\\
 \indent
 In motion planner, safety is always the top priority. We consider autonomous driving safety in, but not limited to, the following aspects: traffic regulations, range coverage, cycle time efficiency and emergency safety. Even in the area of logistics robots, we need also to consider this. All these aspects are critical. Traffic regulations are designed by governments for public transportation safety, and such regulations also apply to autonomous driving vehicles. An autonomous driving vehicle should follow traffic regulations at all times. For range coverage, we aim to provide a trajectory with at least an eight second or two hundred meter motion planning trajectory. The reason is to leave enough room to maintain safe driving within regular autonomous driving vehicle dynamics. The execution time of the motion planning algorithm is also important. In the case of an emergency, the system could react within 100 ms,compared with a 300 ms reaction time for a normal human driver.
 A safety emergency module is the last shell for protecting the safety of riders. For a level-4 motion planner, once upstream modules can no longer function normally, the safety module within the motion planner shall respond with an immediate emergency behavior and send warnings that interrupt humans. Moreover, the autonomous driving system shall have the ability to react to emergencies in a lower-level-like control module.Further safety design is beyond this manuscript’s
 scope. For the logistics robots, We also need to face the different scenarios.\\
 \indent
 In addition to safety, passengers’ ride experience is also important. The measurement of ride experience includes, but is not limited to, scenario coverage, traffic regulation and comfort. For scenario coverage, the motion planner should not only be able to handle simple driving scenarios (e.g., stop, nudge, yield and overtake) but also handle multilane driving, heavy traffic and other complicated on-road driving scenarios.
 Planning within traffic regulations is also important for ride experience. In addition to being a safety requirement, following the traffic regulations will also minimize the risk of accidents and reduce emergency reactions for autonomous driving. The comfort during autonomous driving is also important. In motion planning, comfort is generally measured by the smoothness of the provided autonomous driving trajectory.\\
 \indent
 This report is organized as follows: Chapter 1 is delicated to search-based algorithm. Chapter 2 is delicated to EM planner.
 
 
 \chapter{Seach-based Algorithm}
 For level-4 on-road autonomous driving motion planning, a lane-change strategy is necessary. One common approach is to develop a search algorithm with a cost functional on all possible lanes and then
 select a final trajectory from all the candidates with the lowest cost(See Figure 1.1).
 \begin{figure}[ht]
 	\centering
 	\includegraphics[width=0.6\linewidth]{1_.png}
 	\caption{Ilustration of demonstrated driving scenario consisting of multilane driving in presence of traffic lights. [1]}
 	\label{fig:1.1} 
 \end{figure}
 \section{Problem Of Statement}
 In this section, we define the addressed problem. First, a general driving problem is defined, followed by the formulation of search space and obstacles. Finally, we provide the details about the vehicle model and the cost evaluation.
 \subsection{Driving In Dynamic Environment}
 Driving is a complex task consisting of continuous planning and execution in order to achieve desired goals and avoid collisions with other participants, obey traffic rules, comply with vehicle dynamics and factors like comfort, safety and efficiency. To fully automate driving, the vehicle has to be able to autonomously make decisions and plan its motion, while considering all mentioned requirements. The environment is usually highly dynamic, with speeds that may reach 50m/s or above. Moreover, the environment is complex, including many different participants, traffic rules,traffic control devices, etc. The mentioned conditions impose many different constraints on the driving trajectory.\\
 \indent
 The mayor challenges can be stated as: i) vehicle dynamics influence feasibility of the plans, ii) dynamic constraints are not known during initial planning, iii) the real motion of other participants deviates from the predicted one, iv) planning for long horizons with dynamic constraints is computationally expensive, v) long horizon planning is necessary to achieve long-term benefits such as energy efficiency, vi) conservative assumptions narrow down the search space, which can cause the loss of solution even in the case it exists. Therefore, a frequent replanning with long horizons is necessary while considering the vehicle model and environment as well.
 \subsection{Search Space}
 To tackle dynamic obstacles and avoid the risk of losing quality solutions, we use the 3D space-time $\Omega$ as a search space via Cartesian product of 2D configuration space and time dimension:\\
 \begin{equation}\label{def:ratio}
 \Omega = \{q \equiv [t,s,l]^T 、\, |\, t\in \mathbf{R}^+, s\in \mathbf{R}^+ ,l \in[1,N_l]\}
 \end{equation}\\
 \indent
 Here, t is time, s is the longitudinal position along the road and l is the lateral position on a road. Dimension l is defined such that the middle of the rightmost lane has value 1 while the middle of the left-most lane has value $N_l$. The value 1.5 means that vehicle is halfway between lane 1 and 2.
 \subsection{Obstacles}
 We consider several types of constraints/obstacles, such as constraints imposed by other vehicles, traffic lights, speed limits and forbidden lane-change.\\
 \indent
 1)Vehicle obstacle: Other vehicles on the road represent obstacles for ego vehicle and constrain it’s motion. The violation of these constraints can be manifested not only as a direct collision, but sometimes also as a violation of the driving rules, such as overtaking from right side or slow overtaking from the left side. For a certain vehicle $\mathcal V_k$, the trajectory of its center is described with $s_k(t)$ and $l_k(t)$, while suitable lower and upper bounds can be defined as:
 \begin{equation}
 L_s = L_k / 2 + L_{ego} / 2 
 \end{equation}
 \begin{equation}
 \underline{s}_k(t) = s_k(t) - L_s
 \end{equation}
  \begin{equation}
 \overline{s}_k(t) = s_k(t) + L_s
 \end{equation}
 where $L_k$ is the length of vehicle $\mathcal V_k$ and $L_{ego}$ is the length of ego vehicle. Thus, the$L_{ego}$ is practically incorporated within the obstacle so ego vehicle can be considered as a point. Based on this, the corresponding obstacle can be defined as:
 \begin{equation}
 	\mathcal O_k^V = \{q \in \Omega \, | \, s(t) \in [\underline{s}_k(t),\overline{s}_k(t)]\}
 \end{equation}
 A collision check for a given q, or the condition for which collision occurs can be validated by:
 \begin{equation}
 	\tau (\exists q\in \mathcal O_k^V \, | \,l(t) \in (l_k(t)-1, l_k(t)+1) )
 \end{equation}
 Where $\tau(S)$ denotes the logical value (1 or 0) of the statement S. The assumption made here is that each vehicle
 occupies the whole lane, so if ego vehicle center deviates from the middle of the lane, it is colliding with vehicle in the adjacent lane. It is important to note that this is different from driving in a lane when executing the plan, as the control is not ideal and the vehicle can deviate from the middle of the lane. Figure 1.2 shows an example of geometric representation of the vehicle obstacle within a defined search space $\Omega$. The presented vehicle speeds up and then slows down.
  \begin{figure}[ht]
 	\centering
 	\includegraphics[width=0.6\linewidth]{1_2.png}
 	\caption{Obstacle created by vehicle which is speeding up and slowing down.
 	 [1]}
 	\label{fig:1.2} 
 \end{figure}\\
\indent
Beside collision, it is sometimes forbidden to overtake the vehicle from the right side. This can be expressed by a collision-test given in (1.7). This is modeled by prohibiting velocities greater than the velocity of a vehicle on the left. Beside using the velocity limit, position is used so that in the case when a vehicle tries to overtake the ego vehicle, and ceases overtaking for some reason, the ego vehicle does not slow down too. The corresponding collision test is formulated via:
\begin{equation}
 \tau (\exists q\in \mathcal O_k^V \, | \,l(t) \in [1, l_k(t)-1],\frac{\partial s(t)}{t} \geq 个\frac{\partial s_k(t)}{t},s_k(t) \geq s(t) )
\end{equation}
Practically, overtaking a vehicle requires only a velocity greater than the velocity of a vehicle. However, to limit the time of the overtaking maneuver, in several countries (e.g. Austria) there is also a limit on the minimum velocity difference $\Delta v_{ov} $, when overtaking other vehicles. The corresponding collision test can be formulated as:
\begin{equation}
 \tau (\exists q\in \mathcal O_k^V \, | \,l(t) \in [l_k(t)+1, N_l],\frac{\partial s(t)}{t} \leq \frac{\partial s_k(t)}{t} + \Delta v_{ov} )	
\end{equation}
In multilane urban driving scenarios, rules for overtaking are not applicable.\\
\indent
2)Traffic light obstacle: The traffic light is a traffic control device which prohibits passing the defined line, during specific periods in time on certain lane. Figure 1.3 shows obstacles created by two traffic lights across all lanes although they can be active on a single or several lanes. The obstacle is defined as:
\begin{equation}
\mathcal{O}_{ki}^{TL} = \{ q \in \Omega \. | \, s = s_k,l=l_k, t \in [t_{ki}, t_{ki} + \Delta t_{ki}]\}
\end{equation}
  \begin{figure}[ht]
	\centering
	\includegraphics[width=0.6\linewidth]{1_3.png}
	\caption{Obstacles created by two traffic lights.
		[1]}
	\label{fig:1.3} 
\end{figure}
Each traffic light represents infinitely many obstacles, periodic in t, with the constant or variable period depending
on the traffic light control system. The collision check is performed by evaluating:
\begin{equation}
	\tau(q \cap \mathcal{O}_{ki}^{TL} \neq \emptyset)
\end{equation}
The vehicle trajectory should not pass trough the region of the traffic light at the time when the red light is on.\\
\indent
3)Speed limit: Speed limits may originate from speed limit signs, road curvature or some other factors. They are defined on certain segment of the road and active in the following region of $\Omega$:
\begin{equation}
\mathcal{O}_{k}^{TL} = \{ q \in \Omega\,|\,
s \in [s_k, s_k + \Delta s_k]\}
\end{equation}
The collision check is validated by:
\begin{equation}
\tau(\exists q \in \mathcal{O}_{k}^{TL} \,|\, \frac{\partial s(t)}{t} \geq v_{k_{MAX}} )
\end{equation}
On this segment, the vehicle velocity, represented by a gradient in direction of t, must not exceed the defined value.\\
\indent
4)Forbidden lane-change, solid line: Lane-change prohibition can be also defined on certain segments of the road. It is usually marked with the solid lane line. The obstacle representation is given as:
\begin{equation}
\mathcal{O}_{ki}^{LC} = \{ q \in \Omega \,|\,s \in [s_k, s_k + \Delta s_k],l(t) \in (l_i, l_i+1) \}
\end{equation}
Prohibition may be applicable to both directions, where the collision check is performed by:
\begin{equation}
\tau(q \cap \mathcal{O}_{ki}^{LC} \neq \emptyset)
\end{equation}
Alternatively, the prohibition can hold for single direction. Left-wise lane change prohibition is defined via collision
test (1.15), while the right-wise is defined via negative partial
derivative.
\begin{equation}
\tau(\exists q \in \mathcal{O}_{ki}^{LC} \,|\, \frac{l(t)}{t} > 0)
\end{equation}
Obstacles formulated above are the most common constraints in everyday driving, and the majority of situations can be described by the combination of these. Clearly, multiple obstacles can be active at the same time. It is worth pointing out that the collision checking with respect to such defined obstacles appears to be rather trivial, since it usually reduces to closed-form analysis whether some elementary, analytically defined curves intersect or not, or if the gradient of these curves attain certain values.

 \subsection{Vehicle Model}
 To model the vehicle motion for planning purposes, longitudinal and lateral dynamics should be derived. Assuming
 that the vehicle orientation does not deviate much from the road direction, the longitudinal motion is given by:
 \begin{equation}
 v(t) = \frac{\partial s(t)}{t}
 \end{equation}
 \begin{equation}
  a(t) = \frac{\partial v(t)}{t} = \frac{F_m(t) - F_r(t)}{m}
 \end{equation}
 where v(t) and a(t) are velocity and acceleration along s, and $F_m(t) \,and\, F_r (t) $are forces generated by the motor and resistive force respectively. The rest of the vehicle model is presented in [2] where resistive forces and powertrain losses are modeled in detail. The vehicle model is used for computing the cost of a transition between certain states,$costtrans(v_i , v_f , t_t )$.\\
 \indent
 Since planning includes lane changes as well, modeling the lateral motion is of particular importance. This is not straightforward because of the vehicle kinematics and dynamics. For planning purposes, it is important that the model is conservative so that resulting trajectory is feasible, yet not too conservative to disregard many feasible trajectories. Therefore, the lateral motion is modeled as linear in time such that the vehicle needs a specific time $T _{LC}$ to execute the full lane change. This simplification limits the use of a lane change on smaller velocities, which is acceptable as it can be considered a parking maneuver. Alternatively, the clearance for the lane change on smaller velocities can be provided with by increasing safety buffer around the obstacles.
 \subsection{Cost Function}
 A cost function is used to evaluate quality of a given trajectory. It can reflect multiple goals such as: short travel time [3], comfort [4], safety [5], energy efficiency [2], traffic rules (driving on the rightmost lane [6]) or a combination of these [7]. The design of the cost function is particularly important as it influences vehicle behavior and defines the optimal solution. Cost function used in this work is reflecting energy efficiency and is explained in details in [2], [8] with the additional constant cost for each lane change. The cost function is kept simple while other desired behaviors are implicitly defined through the obstacle formulation.
 \section{Optimal Motion Planning Framework}
 In this section, we elaborate on the proposed optimal MP framework. First, some general aspects of the framework are described, followed by the clarification of individual features.
 \subsection{Framework}
 The proposed framework is based on A* search method [9], guided by an exact cost-to-go map from a relaxed problem in an MPC-like replanning scheme. Each $T_rep$ seconds, replanning is triggered with the current measurement of positions and velocities of other vehicles, traffic lights timing data together with the map data. Based on measurements, the motion of other vehicles is predicted and collision-free trajectory for a defined horizon is generated.\\
 \indent
 The trajectory is generated by a grid-like searching using A*. The grid is constructed by the discretization of t, s and l from the original continuous search space definition. Velocity $v$ is additionally used to provide completeness because of the longitudinal dynamics of the model. Starting from the initial configuration, defined as the initial node, chosen as the first current node, all neighbors are determined by expanding the current node. The resulting child nodes are added to the OPEN list. If the child node is already in the OPEN list, and new child node has a lower cost, the parent of that node is updated, otherwise it is ignored. From the OPEN list, the
 node with the lowest cost is chosen to be the next current node and the procedure is repeated until horizon is reached, the whole graph is explored or the computation time limit for planning is reached. Finally, the node closest to the horizons is used to reconstruct the trajectory. The pseudocode for this procedure is presented in Figure 1.4.
   \begin{figure}[ht]
 	\centering
 	\includegraphics[width=0.6\linewidth]{1_4.png}
 	\caption{Pseudocode using A* for horizon
 		[2]}
 	\label{fig:1.4} 
 \end{figure}\\
\indent
To avoid rounding errors, as the expansion of node creates multiple transitions which in general do not end at gridpoints, the hybrid A* approach [10] is used for planning. Hybrid A* also uses the grid, but keeps continuous values for the next expansion without rounding it to the grid, thus preventing the accumulation of rounding errors.\\
\indent
As $v$ belongs to the discrete set of values as defined in the expansion (Figure 1.5), the hybrid A* approach is used only for $t, s, l$. Therefore, each node n contains 14 values: four indices for $v, t, s, l, (n.v_k , n.t_k , n.s_k , n.l_k )$, four indices for the parent node (to reconstruct trajectory), three remainders from the discretization of $t, s$ and$ l (n.t_r , n.s_r , n.l_r )$, the direction of the lane-change $n.l_dir$ , the exact
cost-to-come to the node ($n.g$), and the estimated total cost of traveling from the initial node to the goal region ($n.f$ ). The value $n.f$ is computed as $n.g + h(n)$, where $h(n)$ is the heuristic function.
   \begin{figure}[ht]
	\centering
	\includegraphics[width=0.6\linewidth]{1_5.png}
	\caption{Pseudocode using A* for expand function
		[2]}
	\label{fig:1.5} 
\end{figure}\\
\indent
The planning clearly requires processing time. The compensation of the planning time can be achieved by introducing T plan , a guaranteed upper bound on planning time. The planning is then initiated from a position where the vehicle would be after the T plan . The old trajectory is executed while the new one is being processed. Thus, the new trajectory is already planed when $T_ plan$ arrives.

\subsection{Node Expansion}
To build trajectories iteratively, nodes are expanded and child nodes are generated, progressing toward the goal. From each node $n$, only dynamically feasible and collision-free child nodes $n'$should be generated. A single child node is generated for each possible longitudinal and lateral motion variant.\\
\indent
The longitudinal motion variants are generated by assuming uniform accelerations from the inherited parent velocity, so that the discrete final velocities (represented by the array $v_f$) are reached at expansion limits. Expansion limits are defined by $ \Delta s_{exp}$ for distance and $\Delta t_{exp} $for time (Figure 1.6). Since trajectories reflect the motion with the uniform acceleration, the average velocity of a specific motion variant equals $v = (v_i + v_f ) /2$. If $v < \Delta s_{exp} /\Delta t_{exp}$ , the trajectory will end on time expansion limit $\Delta t = \Delta t_{exp}$. Otherwise,
it will end on the distance expansion limit $\Delta s = \Delta s_{exp}$. Distance and time values ($\Delta s$ and $\Delta t$) for each variant are summed with the parent node’s remainders $n.s_r$ and $n.t_r$. Resulting sums are used to generate child nodes by increasing parent node’s indices ($n.s_k$ and $n.t_k$ ) with the quotient of division of sums with discretization steps of the grid ($\Delta s$ grid and $\Delta t$ grid ), and computing new remainders. For each child node from the array $n'$, costs are computed as well. Cost-to-come is inherited from the parent and increased by the cost of transition. Cost-to-go is provided by the heuristic function explained in the following subsection. The compliance with the vehicle’s internal constraints (e.g.maximum acceleration) is checked and the nodes that violate these constraints are removed.
   \begin{figure}[ht]
	\centering
	\includegraphics[width=0.6\linewidth]{1_6.png}
	\caption{Expanding parent node $n$ to different child nodes $n'$ by piecewise constant acceleration.[2]}
	\label{fig:1.6} 
\end{figure}\\
\indent
Generated longitudinal motion variants are then used for lateral motion expansion. If the parent node is in the middle of the lane ( $l$ is the integer), variants for possible lane change right and left, beside staying in the lane are generated. Generated variants are tripled, one set of longitudinal variants for each. The values $n'.l_k$ and $n'.l_r$ are increased or decreased for the lane changes left or right respectively. They are modified by the value $\Delta t/T_{LC}$ based on the travel time of the particular variant, and the defined lane change time $T_{LC}$ . If the parent node is already in the process of lane change, lane change is progressed without generating other lateral motion variants. Finally, compliance with obstacles such as other vehicles, traffic lights, etc. is checked and all child nodes and motion variants that are not collision-free are removed.

\subsection{Heuristic Function}
The heuristic function $h(n)$ is used to estimate the cost needed to travel from some node $n$ to the goal state (cost-to-go). As it is shown in [9], if the heuristic function is underestimating the exact cost to go, A* search provides the optimal trajectory. For the shortest path search, the usual heuristic function is the Euclidian distance. To find the energy optimal velocity trajectory, the heuristic function must underestimate the energy needed to drive to the goal. In this framework, the cost-to-go map resulting from the backward search for the relaxed problem is used as heuristic function. The cost-to-go computation phase is executed only once at the beginning of the trip, or if the goal is changed. The computation is performed by using backward dynamic programming (DP), starting from the goal state ($s$ and $v$), backward in $s$, as it was shown in [2].\\
\indent
In this phase, only time invariant constraints are considered (e.g. speed limits) with topological road profile and the vehicle model without considering time-varying constraints. The resulting cost-to-go map is an admissible heuristic, as other vehicles can prohibit certain regions of the state space, which may only increase the cost to travel from the initial state to the goal region. This is valid if platooning effects are neglected, as platooning can potentially reduce the airdrag effect (which is considered in the initial computation), and decrease the cost of travel, but for compact vehicles, this effect is usually negligible. Heuristic function $h(s,v)$ depends only on $s$ and $v$. The resulting heuristic function is applied based on child node’s $s$ and $v$ values, while neglecting $t$ and $l$ values.

\subsection{Search Horizons}
The planing is performed until any of the trajectories reaches time ($T_{hor}$ ) or distance ($S_{hor}$ ) search horizon. Slower driving trajectories will reach the time, while faster trajectories will reach the distance horizon. Thus, the unnecessary planning can be avoided. If only one is chosen (e.g., $T_{hor}$ ) other one could adopt a large even infinite value. The search horizons should not be confused with local expansion limits, which uses a similar principle, but represents atomic motion segments when building the whole trajectory.

\subsection{Vehicle Motion Prediction}
Though it is required for prediction of potential collisions, the perfect knowledge of the future motion of other vehicles is not available in principle. A naive way to predict the motion is to assume that the vehicles will continue to drive with their current velocity and stay in the current lane. On the other hand, a motion planning framework should provide collision-free plans even if trajectories deviate from the predicted one and the environment perception system introduces estimation errors. Therefore, safety buffers are used to increase obstacle regions, and frequent replanning is executed. The approach introduced in this framework is that the most intuitive prediction of driving (constant velocity) is used for finding the optimal trajectory, but an additional safety mechanism ensures a collision-free plan even for the worst case error regarding the relative distance estimation. This is provided by adding a step-like safety buffer to the obstacle. The lower and upper bound of the vehicle obstacle can be defined as:
\begin{equation}
\hat{\underline{s}}_k(t) = \hat{s}_k(t_0) + \hat{v}_k(t_0)(t-t_0) - L_s -s_b(t)
\end{equation}
\begin{equation}
\hat{\overline{s}}_k(t) = \hat{s}_k(t_0) + \hat{v}_k(t_0)(t-t_0) + L_s + s_b(t)
\end{equation}
\begin{equation}
\begin{cases}
\Delta s_{max}, \qquad t_0 \leq t \leq t_0 + T_{rep}\\
3  \Delta s_{max}, \qquad t_0 + T_{rep} \leq t \leq t_0 + T_{hor}
\end{cases}
\end{equation}
\begin{figure}[ht]
	\centering
	\includegraphics[width=0.6\linewidth]{1_7.png}
	\caption{Predicting movement of other vehicle - linearization.[1]}
	\label{fig:1.7} 
\end{figure}
where $\Delta s_{max}$ is the maximum error of the vehicle relative distance estimation. The safety buffer $s_b$ is increased after $T_{rep}$ (the next replanning instance) to maintain robustness,
so that in the next replanning instance, the vehicle always starts from the position that is collision-free according to a
new safety buffer. This is visualized in the Figure 1.7, showing the worst case scenario. The estimation error is such that
in the first planning instance, $\Delta s_{max}$ is positive, while in the second instance, it is negative. It can be seen that the safety buffer from the first planning instance ensures that the trajectory is outside of obstacle area for the time interval $[t_0 , t_0 + T_{rep} ]$ and the trajectory is outside of the safety buffer from the second planning instance for the time interval
$[t_0 + T_{rep} , t_0 + 2·T_{rep} ]$. This safety buffer provides a partial
robustness for deviations from the predicted trajectory as well, but no guarantees can be provided.



 
 \chapter{EM Motion Planner}
 This manuscript presents the Apollo EM planner, which is based on an EM-type iterative algorithm([11]). This planner targets safety and ride experience with a multilane, path-speed iterative, traffic rule and decision combined design.
 \section{Multilane Strategy}
 In the chapter1, we talk about one common approach is to develop a search algorithm
 with a cost functional on all possible lanes, This approach has some difficulties. First, the search space is expanded across multiple lanes, which causes the algorithm to be computationally expensive. Second, traffic regulations (e.g., right of the road, traffic lights) are different across lanes, and it is not easy to apply traffic regulations under the same frame. Furthermore, trajectory stability that avoids sudden changes between cycles should be taken into consideration. It is important to follow consistent on-road driving behavior to inform other drivers of the intention of the autonomous driving vehicle.\\
 \indent
 Typically, a multilane strategy should cover both nonpassive and passive lane-change scenarios. In EM planner, a nonpassive lane-change is a request triggered by the routing module for the purpose of reaching the final destination. A passive lane change is defined as an ego car maneuver when the default lane is blocked by the dynamic environment. In both passive and nonpassive lane changes, we aim to deliver a safe and smooth lane change strategy with a high success rate.
 Thus, we propose a parallel framework to handle both passive and nonpassive lane changes. For candidate lanes, all obstacles and environment information are projected on lane-based Frenet frames. Then, the traffic regulations are bound with the given lane level strategy. Under this framework, each candidate lane will generate a best-possible trajectory based on the lane-level optimizer. Finally, a crosslane trajectory decider will determine which lane to choose based on both the cost functional and safety rules.
 \subsection{The Architecture of EM planner}
 Figure 2.1 presents an overview of EM planner. On top of the planner, all sources of information are collected and synced at the data center module. After data collection, the reference line generator will produce some candidate lane-level reference lines along with information about traffic regulations and obstacles. This process is based on the high-definition map and navigation information from the routing module. During lane-level motion planning, we first construct a Frenet frame based on a specified reference line. The relation between the ego car and its surrounding environment is evaluated in the Frenet frame constructed by the reference line, as well as traffic regulations. Furthermore, restructured information passes to the lane-level optimizer.
    \begin{figure}[ht]
 	\centering
 	\includegraphics[width=0.6\linewidth]{2_1.png}
 	\caption{EM Framework.[12]}
 	\label{fig:2.1} 
 \end{figure}

\subsection{The Lane-Level Optimizer}
The lane-level optimizer module performs path optimization and speed optimization. During path optimization, information about the surroundings is projected on the Frenet frame(E-step).Based on the information projected in the Frenet frame, a smooth path is generated (M-step). Similarly, during speed optimization, once a smooth path is generated by the path optimizer, obstacles are projected on the station-time graph (E-step). Then, the speed optimizer will generate a smooth speed profile (M-step). Combining path and speed profiles, we will obtain a smooth trajectory for the specified lane. In the last step, all lane-level best trajectories are sent to the reference line trajectory decider. Based on the current car status, regulations and the cost of each trajectory, the trajectory decider will decide a best trajectory for the ego car maneuver.
 
 
\section{EM Planner At Lane Level}
In this section, we discuss the lane-level optimization problem. Figure 2.1 shows the path-speed EM iteration inside lane-level planning. The iteration includes two E-steps and two M-steps in one planning cycle. The trajectory information will iterate between planning cycles. We explain the submodules as follows.
    \begin{figure}[ht]
	\centering
	\includegraphics[width=0.6\linewidth]{2_2.png}
	\caption{EM Iteration.[12]}
	\label{fig:2.2} 
\end{figure}\\
\indent
In the first E-step, obstacles are projected on the lane Frenet frame. This projection includes both static obstacle projection and dynamic obstacle projection. Static obstacles will be projected directly based on a Cartesian-Frenet frame transformation. In the Apollo framework, the intentions of dynamic obstacles are described with an obstacle moving trajectory. Considering the previous cycle planning trajectory, we can evaluate the estimated dynamic obstacle and ego car positions at each time point. Then, the overlap of dynamic obstacles and the ego car at each time point will be mapped in the Frenet frame. In addition, the appearance of dynamic obstacles during path optimization will eventually lead to nudging. Thus, for safety considerations, the SL projection of dynamic obstacles will only consider low-speed traffic and oncoming obstacles. For high-speed traffic, EM planner’s parallel lane-change strategy will cover the scenario. In the second E-step, all obstacles, including high-speed, low-speed and oncoming obstacles, are evaluated on the station-time frame based on the generated path profile. If the obstacle trajectory has overlap with the planned path, then a corresponding region in the station-time frame will be generated.\\
\indent
In two M-steps, path and speed profiles are generated by a combination of dynamic programming and quadratic programming. Although we projected obstacles on SL and ST frames, the optimal path and speed solution still lies in a non-convex space. Thus, we use dynamic programming to first obtain a rough solution; meanwhile, this solution can provide obstacle decisions such as nudge, yield and overtake. We use the rough decision to determine a convex hull for the quadratic-programming-based spline optimizer. Then, the optimizer can find solutions within the convex hull. We will cover the modules in the following.

\subsection{SL and ST Mapping}
The SL projection is based on contin-
uous curvature derivative smooth reference line. In Cartesian space, obstacles and the
ego car status are described with location and heading $(x, y, θ)$, as well as curvature and the derivative of curvature $(\kappa, d_{\kappa})$ for the ego car. Then, these are mapped to the Frenet frame coordinates $(s, l, dl, ddl, dddl)$, which represent station, lateral, and lateral derivatives. Since the positions of static obstacles are time invariant, the mapping is straight forward. For dynamic obstacles, we mapped the obstacles with the help of the last cycle trajectory of the ego car. The last cycle’s moving trajectory is projected on the Frenet frame to extract the station direction speed profile. This will provide an estimate of the ego car’s station coordinates given a specific time. The estimated ego car station coordinates will help to evaluate the dynamic obstacle interactions.\\
\indent
Once an ego car’s station coordinates have interacted with an obstacle trajectory point with the same time, a shaded area on the SL map will be marked as the estimated interaction with the dynamic obstacle. Here, the interaction is defined as the ego car and obstacle bounding box overlapping. For example, as shown in Figure 2.3, 
  \begin{figure}[ht]
	\centering
	\includegraphics[width=0.6\linewidth]{2_3.png}
	\caption{SL projection with oncoming traffic example.[12]}
	\label{fig:2.3} 
\end{figure}
an oncoming dynamic obstacle and corresponding trajectory estimated from the prediction module are marked in red. The ego car is marked in blue. The trajectory of the oncoming dynamic obstacle is first discretized into several trajectory points with time, and then the points are projected to the Frenet frame. Once we find that the ego car’s station coordinates have an interaction with the projected obstacle points, the overlap region (shown in purple in the figure 2.3) will be marked in the Frenet frame.\\
\indent
ST projection helps us evaluate the ego car’s speed profile. After the path optimizer generates a smooth path profile in the Frenet Frame, both static obstacle and dynamic obstacle trajectories are projected on the path if there are any interactions.An interaction is also defined as the bounding boxes overlapping. In Figure 2.4,
  \begin{figure}[ht]
	\centering
	\includegraphics[width=0.6\linewidth]{2_4.png}
	\caption{ST projection with cut-in obstacle and obstacle behind ego care.[12]}
	\label{fig:2.4} 
\end{figure}
 one obstacle cut into the ego driving path at 2 seconds and 40 meters ahead, as marked in red, and one obstacle behind the ego car is marked in green. The remaining region is the speed profile feasible region. The speed optimization M-step will attempt to find a feasible smooth solution in this region.
 
 \subsection{M-Step DP Path}
 
 \chapter{Actual work}
  
 
 When dealing with rectangled triangles (see Figure \ref{triangle}) I sometimes used this theorem from \cite{pythm001}:
 \begin{equation}\label{theo}
  a^2 + b^2 = c^2
 \end{equation}The demonstration is in Appendix \ref{sec:prooftheorem}.
 
 
 \chapter{Experiments}
 
 When trying to draw a rectangled triangle, my program comes up with Figure \ref{triangle2} that is neither rectangled nor a triangle.
 
Unless there is a bug in my program, which is unlikely, this research indicates that the whole theory on triangles having 3 sides has been wrong for years, maybe decades.
 
 
 \chapter*{Conclusion}
 \addcontentsline{toc}{chapter}{Conclusion}
 
% % switch to A-B-C chaptering
% \appendix	
% 
% \chapter{Proof of theorem \ref{theo}}
% \label{sec:prooftheorem}
% 
 
 
 \addcontentsline{toc}{chapter}{Bibliography}
 \bibliographystyle{IEEEtran}
 
 \bibliography{../biblio.bib}
 \cite{DBLP:journals/corr/abs-1803-04868}
 \cite{inbook}
 \cite{583794}
 \cite{article}
 \cite{article5}
 \cite{7313361}
 \cite{article7}
 \cite{6f42273b120f421fa980c61913dcd489}
 \cite{4082128}
 \cite{article10}
 \cite{10.2307/2984875}
 \cite{DBLP:journals/corr/abs-1807-08048}
 
 
 
\end{document}
